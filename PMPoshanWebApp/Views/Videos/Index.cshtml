@using PMPoshanWebApp.Helpers
@model PMPoshanWebApp.Integrations.EMIS.Models.VideoVM
@{
    ViewData["Title"] = "Video Album";
    Layout = "~/Views/Shared/_Layout.cshtml";

}
<main class="flex flex-1 justify-center py-5 sm:py-10">
    <div class="layout-content-container flex flex-col max-w-7xl flex-1 px-4 sm:px-6 lg:px-8">

        <!-- Breadcrumbs -->
        <div class="mb-4 flex flex-wrap items-center gap-2">
            <a class="text-sm text-gray-600 dark:text-gray-400 hover:text-accent" href="/">Home</a>
            <span class="text-sm text-gray-400 dark:text-gray-500">/</span>
            <span class="text-sm font-medium text-gray-800 dark:text-gray-200">Videos</span>
        </div>

        <!-- Page Heading -->
        <div class="mb-8 flex flex-wrap items-baseline justify-between gap-4">
            <h1 class="text-3xl font-bold text-primary md:text-4xl">Video Gallery</h1>
        </div>

        <!-- Video Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 p-4">

            @if (Model.VideoAlbums?.Albums != null && Model.VideoAlbums.Albums.Any())
            {
                foreach (var item in Model.VideoAlbums.Albums)
                {
                    var thumbnail = YoutubeHelper.GetYoutubeThumbnail(item.VideoCoverLink);

                    <a href="/videos/videogallery?albumId=@item.VideoAlbumID"
                       class="group flex flex-col overflow-hidden rounded-xl bg-[#faf7f2] shadow-md transition-all hover:shadow-xl dark:hover:shadow-primary/20">

                        <div class="relative h-70 md:h-40 w-full bg-cover bg-center rounded-lg transition-transform duration-300 group-hover:scale-105 bg-[#faf7f2]"
                             style='background-image: url("@thumbnail");'
                             title="@item.VideoAlbumDesc">
                            <div class="absolute inset-0 bg-black/25 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                <span class="material-symbols-outlined text-white text-4xl">
                                    play_circle
                                </span>
                            </div>
                        </div>

                        <div class="p-5 bg-[#faf7f2]">
                            <p class="text-lg font-bold text-gray-900 dark:text-gray-500">
                                @item.VideoAlbumDesc
                            </p>

                            <div class="mt-3 flex items-center justify-between bg-[#faf7f2] text-sm text-gray-500 dark:text-gray-400">
                                <div class="flex items-center gap-1.5">
                                    <span class="material-symbols-outlined" style="font-size: 18px;">play_circle</span>
                                    <span>@item.VideoCount Videos</span>
                                </div>
                            </div>
                        </div>

                    </a>


                    
                }
            }
            else
            {
                <p class="text-center col-span-full text-gray-500">No Videos Found</p>
            }

        </div>

        <!-- Pagination -->
        @if (Model.VideoAlbums?.PagingInfo != null && Model.VideoAlbums.PagingInfo.TotalPages > 1)
        {
            var paging = Model.VideoAlbums.PagingInfo;

            <div class="mt-12 flex items-center justify-center p-4">
                <nav class="flex items-center gap-2">

                    <!-- Previous -->
                    @if (paging.CurrentPage > 1)
                    {
                        <a href="@Url.Action("Index", new { page = paging.CurrentPage - 1 })"
                           class="flex h-10 items-center justify-center px-2 text-sm font-medium text-gray-600 dark:text-gray-400 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                            <span class="material-symbols-outlined">chevron_left</span>
                            <span class="hidden sm:inline">Previous</span>
                        </a>
                    }

                    @{
                        int totalPages = paging.TotalPages;
                        int currentPage = paging.CurrentPage;
                        int windowSize = 1;

                        int startPage = Math.Max(1, currentPage - windowSize);
                        int endPage = Math.Min(totalPages, currentPage + windowSize);
                    }

                    <!-- First page + ellipsis -->
                    @if (startPage > 1)
                    {
                        <a href="@Url.Action("Index", new { pageNo = 1 })"
                           class="flex h-10 w-10 items-center justify-center rounded-lg text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-800">1</a>

                        @if (startPage > 2)
                        {
                            <span class="px-2 text-gray-500">...</span>
                        }
                    }

                    <!-- Middle Pages -->
                    @for (int i = startPage; i <= endPage; i++)
                    {
                        if (i == currentPage)
                        {
                            <a href="@Url.Action("Index", new { pageNo = i })"
                               class="flex h-10 w-10 items-center justify-center rounded-lg bg-primary text-sm font-bold text-white">@i</a>
                        }
                        else
                        {
                            <a href="@Url.Action("Index", new { pageNo = i })"
                               class="flex h-10 w-10 items-center justify-center rounded-lg text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-800">@i</a>
                        }
                    }

                    <!-- Last page + ellipsis -->
                    @if (endPage < totalPages)
                    {
                        @if (endPage < totalPages - 1)
                        {
                            <span class="px-2 text-gray-500">...</span>
                        }

                        <a href="@Url.Action("Index", new { pageNo = totalPages })"
                           class="flex h-10 w-10 items-center justify-center rounded-lg text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-800">@totalPages</a>
                    }

                    <!-- Next -->
                    @if (paging.CurrentPage < paging.TotalPages)
                    {
                        <a href="@Url.Action("Index", new { pageNo = paging.CurrentPage + 1 })"
                           class="flex h-10 items-center justify-center px-2 text-sm font-medium text-gray-600 dark:text-gray-400 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                            <span class="hidden sm:inline">Next</span>
                            <span class="material-symbols-outlined">chevron_right</span>
                        </a>
                    }

                </nav>
            </div>
        }
    </div>
</main>
